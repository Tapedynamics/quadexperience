---
export interface Props {
  title: string;
  description: string;
  image?: string;
  canonical?: string;
  lang: 'it' | 'en' | 'es' | 'fr';
  type?: 'website' | 'article' | 'product' | 'profile';
  article?: {
    publishedTime?: string;
    modifiedTime?: string;
    author?: string;
    section?: string;
    tags?: string[];
  };
  product?: {
    price?: number;
    currency?: string;
    availability?: 'in_stock' | 'out_of_stock' | 'preorder';
  };
  organization?: boolean;
  breadcrumbs?: Array<{
    name: string;
    url: string;
  }>;
}

const {
  title,
  description,
  image = '/images/og-default.jpg',
  canonical,
  lang,
  type = 'website',
  article,
  product,
  organization = false,
  breadcrumbs
} = Astro.props;

const canonicalURL = canonical || new URL(Astro.url.pathname, Astro.site);
const fullImageUrl = new URL(image, Astro.site);

// Language mapping
const langMapping = {
  it: 'it_IT',
  en: 'en_US',
  es: 'es_ES',
  fr: 'fr_FR'
};

const ogLocale = langMapping[lang];

// Organization schema
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": `${Astro.site}#organization`,
  "name": "Tenerife Quad Experience",
  "url": Astro.site,
  "logo": new URL('/images/logo.png', Astro.site),
  "image": [
    new URL('/images/hero-1.jpg', Astro.site),
    new URL('/images/hero-2.jpg', Astro.site),
    new URL('/images/hero-3.jpg', Astro.site)
  ],
  "description": "Experience the best quad adventures in Tenerife. Explore volcanic landscapes and spectacular coasts with professional guides.",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Calle Quad Experience 123",
    "addressLocality": "Santa Cruz de Tenerife",
    "postalCode": "38001",
    "addressCountry": "ES"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": 28.4636,
    "longitude": -16.2518
  },
  "telephone": "+34 922 123 456",
  "email": "info@tenerifequadexperience.com",
  "openingHours": [
    "Mo-Su 09:00-18:00"
  ],
  "priceRange": "€65-€125",
  "servesCuisine": [],
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "name": "Quad Tours",
    "itemListElement": [
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Product",
          "name": "Teide Volcanic Tour",
          "description": "Explore the Teide volcano with quad bikes"
        }
      },
      {
        "@type": "Offer",
        "itemOffered": {
          "@type": "Product",
          "name": "Coastal Adventure",
          "description": "Discover Tenerife's spectacular coastline"
        }
      }
    ]
  },
  "areaServed": {
    "@type": "Place",
    "name": "Tenerife, Canary Islands"
  }
};

// Breadcrumb schema
const breadcrumbSchema = breadcrumbs ? {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": breadcrumbs.map((crumb, index) => ({
    "@type": "ListItem",
    "position": index + 1,
    "name": crumb.name,
    "item": new URL(crumb.url, Astro.site)
  }))
} : null;

// Article schema (for blog posts)
const articleSchema = article ? {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "image": fullImageUrl,
  "datePublished": article.publishedTime,
  "dateModified": article.modifiedTime || article.publishedTime,
  "author": {
    "@type": "Person",
    "name": article.author || "Tenerife Quad Experience"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Tenerife Quad Experience",
    "logo": {
      "@type": "ImageObject",
      "url": new URL('/images/logo.png', Astro.site)
    }
  },
  "articleSection": article.section,
  "keywords": article.tags?.join(", "),
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": canonicalURL
  }
} : null;

// Product schema (for tours)
const productSchema = product ? {
  "@context": "https://schema.org",
  "@type": "Product",
  "name": title,
  "description": description,
  "image": fullImageUrl,
  "offers": {
    "@type": "Offer",
    "price": product.price,
    "priceCurrency": product.currency || "EUR",
    "availability": `https://schema.org/${product.availability === 'in_stock' ? 'InStock' : product.availability === 'out_of_stock' ? 'OutOfStock' : 'PreOrder'}`,
    "seller": {
      "@type": "Organization",
      "name": "Tenerife Quad Experience"
    }
  },
  "brand": {
    "@type": "Brand",
    "name": "Tenerife Quad Experience"
  }
} : null;
---

<!-- Basic Meta Tags -->
<meta name="description" content={description} />
<meta name="generator" content={Astro.generator} />

<!-- Canonical -->
<link rel="canonical" href={canonicalURL} />

<!-- Open Graph -->
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={fullImageUrl} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:type" content={type} />
<meta property="og:locale" content={ogLocale} />
<meta property="og:site_name" content="Tenerife Quad Experience" />

{article && (
  <>
    <meta property="article:published_time" content={article.publishedTime} />
    {article.modifiedTime && <meta property="article:modified_time" content={article.modifiedTime} />}
    {article.author && <meta property="article:author" content={article.author} />}
    {article.section && <meta property="article:section" content={article.section} />}
    {article.tags && article.tags.map(tag => <meta property="article:tag" content={tag} />)}
  </>
)}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={fullImageUrl} />

<!-- Language alternatives -->
<link rel="alternate" hreflang="it" href={new URL(Astro.url.pathname.replace(/^\/(?:en|es|fr)/, ''), Astro.site)} />
<link rel="alternate" hreflang="en" href={new URL(`/en${Astro.url.pathname.replace(/^\/(?:en|es|fr)/, '')}`, Astro.site)} />
<link rel="alternate" hreflang="es" href={new URL(`/es${Astro.url.pathname.replace(/^\/(?:en|es|fr)/, '')}`, Astro.site)} />
<link rel="alternate" hreflang="fr" href={new URL(`/fr${Astro.url.pathname.replace(/^\/(?:en|es|fr)/, '')}`, Astro.site)} />
<link rel="alternate" hreflang="x-default" href={new URL(Astro.url.pathname.replace(/^\/(?:en|es|fr)/, ''), Astro.site)} />

<!-- Schema.org Structured Data -->
{organization && (
  <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
)}

{breadcrumbSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
)}

{articleSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
)}

{productSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(productSchema)} />
)}